<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Bootstrap布局</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <link href="./css/bootstrap/4.1.0/bootstrap.css" rel="stylesheet" />
    <link href="./css/mars-doc.css" rel="stylesheet" />

    <script type="text/javascript" src="./js/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap/4.1.0/bootstrap.js"></script>
    <script type="text/javascript" src="./js/mars-doc.js"></script>

</head>
<body>
<div class="wrap">

    <!--顶部-->
    <div class="top">
        <div class="top-left">
            欢迎使用 mars doc
        </div>
        <div class="top-right">
            <input type="input" class="search-input form-control" name="s" placeholder="搜索..." aria-label="Search">
        </div>
    </div>

    <!-- 左边内容 -->
    <div id="left" class="left" >

        <ul id="menu" class="nav nav-list">
            <li class="detailMenu">
                <a class="ma1">一级菜单</a>
                <ul class="submenu">
                    <li class="menuLi">
                        <a class="ma2">二级菜单1</a>
                    </li>
                    <li class="menuLi">
                        <a class="ma2">二级菜单2</a>
                    </li>
                </ul>
            </li>
            <li class="detailMenu">
                <a class="ma1">二级菜单</a>
                <ul class="submenu">
                    <li class="menuLi">
                        <a class="ma2">二级菜单1</a>
                    </li>
                    <li class="menuLi">
                        <a class="ma2">二级菜单2</a>
                    </li>
                </ul>
            </li>
        </ul>

    </div>
    <!-- 右边内容 -->
    <div id="right" class="tab-content right">
        <ul class="nav nav-tabs">
            <li class="active" ><a href="#tab1">第一个TAB</a> <span class="close"></span>
            </li>
            <li><a href="#tab2" >第二个TAB</a> <span class="close"></span></li>
        </ul>


        <!--<div id="one" class="tab-pane active">
                             <span style="margin-left:40px;text-shadow: 2px 0px 6px rgba(94, 35, 255, 0.91);">
                                   内容一
                            </span>
        </div>
        <div id="two" class="tab-pane">
                             <span style="margin-left:40px;text-shadow: 2px 0px 6px rgba(94, 35, 255, 0.91);">
                                   内容二
                            </span>
        </div>
        <div id="three" class="tab-pane">
                             <span style="margin-left:40px;text-shadow: 2px 0px 6px rgba(94, 35, 255, 0.91);">
                                   内容三
                            </span>
        </div>-->
        <div id="four" class="tab-pane">
            <iframe id="fourIfm" frameborder="no" border="0" style="width:100%;" scrolling="no">
            </iframe>
        </div>
    </div>
</div>
</body>
<script>

    $(function () {
        init();
    });

    function initLeftMenu(){
        $("#menu .ma1").on("click",function () {
            if ($(this).parent().hasClass("active")){
                $(this).parent().removeClass("active").find(".submenu").hide(100);
            }else{
                $(".detailMenu").removeClass("active").find(".submenu").hide(100);
                $(this).parent().addClass("active").find(".submenu").show(300);
            }
        });

        $("#menu .menuLi .ma2").on("click",function (){
            addTab(this);
        });
        initTabs();
    }


    function initTabs(){
        $(".nav-tabs li").on("click",function (){
            $(".nav-tabs li").removeClass("active");
            $(this).addClass("active");
        });
        initTabsClose();
    }
    function initTabsClose(){
        $(".nav-tabs .close").on("click",function (){
            closeTab(this);
        })
    }
    function closeTab(obj){
        $(obj).parent().remove();
    }






    function addTab(obj){
        let classId = $(obj).attr("data-class-id");
        let methodId = $(obj).attr("data-method-id");
        let classList =JSON.parse(storage.get("classList"));
        let classVo = null;

        for (let k = 0; k < classList.length; k++) {
            let clazz = classList[k];
            if (clazz.classId == classId){
                classVo = clazz;
                break
            }
        }

        if (classVo){
            for (let j = 0; j < classVo.methodList.length; j++) {
                let method = classVo.methodList[j];
                let $methodId = method.path+"#"+method.method;
                if ($methodId == methodId){
                    let description = method.description;
                    addTabMethod(description,$methodId);
                    break;
                }
            }
        }
    }

    function addTabMethod(name,methodId){
        let tabs = $(".nav-tabs li");
        let flag = false;
        if (tabs){
            for (let i = 0; i < tabs.length; i++) {
                let $methodId = $( tabs[i]).find("a").attr("data-method-id");
                log.log("leftMethodId:"+methodId+" navMethodId:"+$methodId);
                if ($methodId == methodId){
                    $(tabs[i]).addClass("active");
                    flag = true;
                }else{
                    $(tabs[i]).removeClass("active");
                }
            }
        }
        if (!flag){
            let h = "<li class='active'><a data-method-id='"+methodId+"' href=\"#tab2\" >"+name+"</a> <span class=\"close\"></span></li>";
            $(".nav-tabs").append(h);
        }
        initTabs();
    }



    function init(){
        util.post("./mars/api",{},false,true,function (data){
            if (data){
                let menuHtml="";
                let classList = data.classList;

                storage.set("classList",JSON.stringify(classList));
                storage.set("reqList",JSON.stringify(data.requestList));
                storage.set("response",JSON.stringify(data.responseList));

                if (classList){


                    for (let i = 0; i < classList.length; i++) {
                        let classInfo =classList[i];
                        menuHtml+="<li class=\"detailMenu\">"
                        menuHtml+="<a class=\"ma1\">"+classInfo.description+"</a>";

                        let methodList = classInfo.methodList;
                        menuHtml+="<ul class=\"submenu\">";
                        if (methodList){
                            for (let j = 0; j < methodList.length; j++) {
                                let methodInfo = methodList[j];

                                let methodType = methodInfo.method;
                                let methodId = methodInfo.path+"#"+methodInfo.method;

                                menuHtml+="<li class=\"menuLi\">" +
                                    "<a class=\"ma2\" data-class-id='"+classInfo.classId+"'  data-method-id='"+methodId+"' >"+methodType+"&nbsp;&nbsp;"+methodInfo.description+"</a>" +
                                    "</li>" ;
                            }
                        }
                        menuHtml+="</ul>"
                        menuHtml+="</li>"
                    }
                }
                $("#menu").html(menuHtml);

                initLeftMenu();
            }
        });
    }

</script>
</html>
